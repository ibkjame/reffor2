<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ผลคำทำนาย - REFFORTUNE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* --- THEME & BACKGROUND --- */
    body {
        font-family: 'Noto Sans Thai', sans-serif;
        background: linear-gradient(135deg, #9E63BF 0%, #764ba2 100%);
        color: #ffffff;
        overflow-x: hidden;
    }
    .space-bg {
        background: linear-gradient(135deg, #9E63BF 0%, #764ba2 50%, #f093fb 100%);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        position: fixed; inset: 0; z-index: -2;
    }
    @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    .stars { position: fixed; inset: 0; background: transparent url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/1231630/stars.png) repeat top center; z-index: -1; }
    .twinkling { position: fixed; inset: 0; background: transparent url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/1231630/stars.png) repeat top center; z-index: 0; animation: move-twinkle-back 300s linear infinite; opacity: 0.4; }
    @keyframes move-twinkle-back { from { background-position: 0 0; } to { background-position: -10000px 5000px; } }

    /* --- Glassmorphism Style --- */
    .glass-box {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 24px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    .text-glow { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5), 0 0 40px rgba(167, 139, 250, 0.3); }

    /* --- Result Card Style --- */
    .result-card {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeIn 0.8s ease-out forwards;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

     .fab-home-btn {
      position: fixed; left: 50%; bottom: 22px; transform: translateX(-50%); z-index: 100; display: none;
      background: linear-gradient(45deg, #9E63BF, #764ba2);
      box-shadow: 0 8px 32px rgba(76, 58, 162, 0.44);
    }
    @media (max-width: 768px) { .fab-home-btn { display: flex !important; } }
  </style>
</head>
<body class="antialiased">
  <div class="space-bg"></div>
  <div class="stars"></div>
  <div class="twinkling"></div>

  <main class="relative z-10 w-full max-w-7xl mx-auto p-4 md:p-8">
    <header class="text-center mb-8">
      <a href="/" class="inline-block mb-4">
        <img src="/icon/main.png" alt="โลโก้ ดูดวงกับเรฟ REFFORTUNE" class="w-full max-w-[250px] md:max-w-xs mx-auto">
      </a>
      <div id="header-text" class="p-4 max-w-2xl mx-auto">
        <h1 id="results-title" class="text-2xl md:text-3xl font-bold text-glow">ผลคำทำนายของคุณ</h1>
        <p id="results-subtitle" class="text-white/80 mt-1">นี่คือไพ่ที่คุณได้เลือกไว้</p>
      </div>
       <div><a href="/" class="text-purple-300 hover:text-white mb-4 inline-block">← กลับหน้าหลัก</a></div>
    </header>

    <div id="results-area-wrapper" class="p-4 md:p-8">
        <div id="results-area" class="flex justify-center items-center flex-wrap gap-4 md:gap-6">
          <!-- Results will be generated by JavaScript -->
        </div>
    </div>

    <div id="action-buttons" class="text-center mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
        <!-- Buttons will be generated by JavaScript -->
    </div>

     <a href="/" class="fab-home-btn shadow-lg rounded-full p-0.5">
    <div class="flex items-center justify-center bg-gray-800/80 backdrop-blur-sm rounded-full w-16 h-16 border border-white/20">
      <svg width="38" height="38" fill="none" stroke="currentColor" stroke-width="2.2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
  </main>

  <script>
    const fullTarotDeck = [
        // This data must be identical to the one in pick.html
        { id: 'maj00', name: 'The Fool', img: 'card/00.png' }, { id: 'maj01', name: 'The Magician', img: 'card/01.png' }, { id: 'maj02', name: 'The High Priestess', img: 'card/02.png' }, { id: 'maj03', name: 'The Empress', img: 'card/03.png' }, { id: 'maj04', name: 'The Emperor', img: 'card/04.png' }, { id: 'maj05', name: 'The Hierophant', img: 'card/05.png' }, { id: 'maj06', name: 'The Lovers', img: 'card/06.png' }, { id: 'maj07', name: 'The Chariot', img: 'card/07.png' }, { id: 'maj08', name: 'Strength', img: 'card/08.png' }, { id: 'maj09', name: 'The Hermit', img: 'card/09.png' }, { id: 'maj10', name: 'Wheel of Fortune', img: 'card/10.png' }, { id: 'maj11', name: 'Justice', img: 'card/11.png' }, { id: 'maj12', name: 'The Hanged Man', img: 'card/12.png' }, { id: 'maj13', name: 'Death', img: 'card/13.png' }, { id: 'maj14', name: 'Temperance', img: 'card/14.png' }, { id: 'maj15', name: 'The Devil', img: 'card/15.png' }, { id: 'maj16', name: 'The Tower', img: 'card/16.png' }, { id: 'maj17', name: 'The Star', img: 'card/17.png' }, { id: 'maj18', name: 'The Moon', img: 'card/18.png' }, { id: 'maj19', name: 'The Sun', img: 'card/19.png' }, { id: 'maj20', name: 'Judgement', img: 'card/20.png' }, { id: 'maj21', name: 'The World', img: 'card/21.png' },
        { id: 'wan01', name: 'Ace of Wands', img: 'card/w1.png' }, { id: 'wan02', name: 'Two of Wands', img: 'card/w2.png' }, { id: 'wan03', name: 'Three of Wands', img: 'card/w3.png' }, { id: 'wan04', name: 'Four of Wands', img: 'card/w4.png' }, { id: 'wan05', name: 'Five of Wands', img: 'card/w5.png' }, { id: 'wan06', name: 'Six of Wands', img: 'card/w6.png' }, { id: 'wan07', name: 'Seven of Wands', img: 'card/w7.png' }, { id: 'wan08', name: 'Eight of Wands', img: 'card/w8.png' }, { id: 'wan09', name: 'Nine of Wands', img: 'card/w9.png' }, { id: 'wan10', name: 'Ten of Wands', img: 'card/w10.png' }, { id: 'wan_p', name: 'Page of Wands', img: 'card/w11.png' }, { id: 'wan_k', name: 'Knight of Wands', img: 'card/w12.png' }, { id: 'wan_q', name: 'Queen of Wands', img: 'card/w13.png' }, { id: 'wan_K', name: 'King of Wands', img: 'card/w14.png' },
        { id: 'cup01', name: 'Ace of Cups', img: 'card/c1.png' }, { id: 'cup02', name: 'Two of Cups', img: 'card/c2.png' }, { id: 'cup03', name: 'Three of Cups', img: 'card/c3.png' }, { id: 'cup04', name: 'Four of Cups', img: 'card/c4.png' }, { id: 'cup05', name: 'Five of Cups', img: 'card/c5.png' }, { id: 'cup06', name: 'Six of Cups', img: 'card/c6.png' }, { id: 'cup07', name: 'Seven of Cups', img: 'card/c7.png' }, { id: 'cup08', name: 'Eight of Cups', img: 'card/c8.png' }, { id: 'cup09', name: 'Nine of Cups', img: 'card/c9.png' }, { id: 'cup10', name: 'Ten of Cups', img: 'card/c10.png' }, { id: 'cup_p', name: 'Page of Cups', img: 'card/c11.png' }, { id: 'cup_k', name: 'Knight of Cups', img: 'card/c12.png' }, { id: 'cup_q', name: 'Queen of Cups', img: 'card/c13.png' }, { id: 'cup_K', name: 'King of Cups', img: 'card/c14.png' },
        { id: 'swo01', name: 'Ace of Swords', img: 'card/s1.png' }, { id: 'swo02', name: 'Two of Swords', img: 'card/s2.png' }, { id: 'swo03', name: 'Three of Swords', img: 'card/s3.png' }, { id: 'swo04', name: 'Four of Swords', img: 'card/s4.png' }, { id: 'swo05', name: 'Five of Swords', img: 'card/s5.png' }, { id: 'swo06', name: 'Six of Swords', img: 'card/s6.png' }, { id: 'swo07', name: 'Seven of Swords', img: 'card/s7.png' }, { id: 'swo08', name: 'Eight of Swords', img: 'card/s8.png' }, { id: 'swo09', name: 'Nine of Swords', img: 'card/s9.png' }, { id: 'swo10', name: 'Ten of Swords', img: 'card/s10.png' }, { id: 'swo_p', name: 'Page of Swords', img: 'card/s11.png' }, { id: 'swo_k', name: 'Knight of Swords', img: 'card/s12.png' }, { id: 'swo_q', name: 'Queen of Swords', img: 'card/s13.png' }, { id: 'swo_K', name: 'King of Swords', img: 'card/s14.png' },
        { id: 'pen01', name: 'Ace of Pentacles', img: 'card/p1.png' }, { id: 'pen02', name: 'Two of Pentacles', img: 'card/p2.png' }, { id: 'pen03', name: 'Three of Pentacles', img: 'card/p3.png' }, { id: 'pen04', name: 'Four of Pentacles', img: 'card/p4.png' }, { id: 'pen05', name: 'Five of Pentacles', img: 'card/p5.png' }, { id: 'pen06', name: 'Six of Pentacles', img: 'card/p6.png' }, { id: 'pen07', name: 'Seven of Pentacles', img: 'card/p7.png' }, { id: 'pen08', name: 'Eight of Pentacles', img: 'card/p8.png' }, { id: 'pen09', name: 'Nine of Pentacles', img: 'card/p9.png' }, { id: 'pen10', name: 'Ten of Pentacles', img: 'card/p10.png' }, { id: 'pen_p', name: 'Page of Pentacles', img: 'card/p11.png' }, { id: 'pen_k', name: 'Knight of Pentacles', img: 'card/p12.png' }, { id: 'pen_q', name: 'Queen of Pentacles', img: 'card/p13.png' }, { id: 'pen_K', name: 'King of Pentacles', img: 'card/p14.png' }
    ];

    const resultsArea = document.getElementById('results-area');
    const resultsTitle = document.getElementById('results-title');
    const resultsSubtitle = document.getElementById('results-subtitle');
    const actionButtons = document.getElementById('action-buttons');

    function findCardById(cardId) {
        return fullTarotDeck.find(card => card.id === cardId) || null;
    }

    function saveResultsAsImage() {
        const resultsWrapper = document.getElementById('results-area-wrapper');
        const headerText = document.getElementById('header-text');
        
        resultsWrapper.prepend(headerText.cloneNode(true));
        
        html2canvas(resultsWrapper, {
            backgroundColor: null,
            useCORS: true
        }).then(canvas => {
            resultsWrapper.removeChild(resultsWrapper.firstChild);

            const link = document.createElement('a');
            link.download = 'reffortune-reading.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }

    function displayResults(cardIds, count) {
        resultsArea.innerHTML = '';
        const selectedCardsData = cardIds.map(id => findCardById(id)).filter(Boolean);

        if (count === 10) {
            resultsTitle.textContent = 'ไพ่ทั้ง 10 ใบของคุณ';
            resultsSubtitle.textContent = 'นี่คือไพ่ที่คุณเลือกและคำทำนายสถานการณ์ของคุณ';
        }

        if (count === 10) {
            resultsArea.className = 'grid grid-cols-5 sm:grid-cols-5 gap-4 md:gap-6 w-full';
        } else {
            resultsArea.className = 'flex justify-center items-center flex-wrap gap-4 md:gap-8 py-8';
        }

        selectedCardsData.forEach((card, index) => {
            const resultCardContainer = document.createElement('div');
            let sizeClass = '';
            if (count !== 10) {
                sizeClass = (count === 1) ? 'w-1/2 sm:w-1/3 md:w-1/4' : 
                            (count === 2) ? 'w-2/5 sm:w-1/3 md:w-1/4' : 
                            (count === 3) ? 'w-1/4 sm:w-1/4 md:w-1/5' : 
                            'w-1/2 sm:w-1/4 md:w-1/5';
            } else {
                sizeClass = 'w-full';
            }

            resultCardContainer.className = `result-card ${sizeClass}`;
            resultCardContainer.style.animationDelay = `${index * 0.15}s`;
            
            resultCardContainer.innerHTML = `
                <img src="${card.img}" alt="${card.name}" class="w-full rounded-lg shadow-2xl">
                <p class="text-center text-white/155 font-xxs mt-2 text-xs md:text-xs">${card.name}</p>
            `;
            resultsArea.appendChild(resultCardContainer);
        });

        actionButtons.innerHTML = `
            <button onclick="saveResultsAsImage()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">บันทึกผลเป็นรูปภาพ</button>
            <a href="pick.html?count=${count}" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">เลือกไพ่ใหม่อีกครั้ง</a>
        `;
    }

    function initializePage() {
        const urlParams = new URLSearchParams(window.location.search);
        const count = parseInt(urlParams.get('count'));
        const cardIdsString = urlParams.get('cards');

        if (count && cardIdsString) {
            const cardIds = cardIdsString.split(',');
            if (cardIds.length === count) {
                displayResults(cardIds, count);
            } else {
                 resultsArea.innerHTML = `<p class="text-center text-xl">จำนวนไพ่ที่ส่งมาไม่ตรงกับที่เลือกไว้</p>`;
            }
        } else {
            resultsArea.innerHTML = `<p class="text-center text-xl">ไม่พบข้อมูลคำทำนาย กรุณากลับไปเลือกไพ่อีกครั้ง</p>`;
        }
    }

    document.addEventListener('DOMContentLoaded', initializePage);
  </script>
</body>
</html>
